{
    "name": "GW",
    "type": "flogo:app",
    "version": "0.0.1",
    "appModel": "1.0.0",
    "description": "IoT gateway",
    "triggers": [
        {
            "id": "receive_mqtt_message",
            "ref": "github.com/TIBCOSoftware/flogo-contrib/trigger/mqtt",
            "name": "Receive MQTT Message",
            "description": "Simple MQTT Trigger",
            "settings": {
                "broker": "tcp://127.0.0.1:1883",
                "id": "FLOGO_MQTT_CLIENT",
                "user": "",
                "password": "",
                "store": ":memory:",
                "topic": "vfdemo/Alexa",
                "qos": 0,
                "cleansess": false
            },
            "handlers": [
                {
                    "action": {
                        "ref": "github.com/TIBCOSoftware/flogo-contrib/action/flow",
                        "data": {
                            "flowURI": "res://flow:alexa_gw_gpio_led"
                        }
                    },
                    "settings": {
                        "topic": "vfdemo/Alexa"
                    }
                }
            ]
        },
        {
            "id": "receive_http_message_2",
            "ref": "github.com/TIBCOSoftware/flogo-contrib/trigger/rest",
            "name": "Receive HTTP Message (2)",
            "description": "Simple REST Trigger",
            "settings": {
                "port": "80"
            },
            "handlers": [
                {
                    "action": {
                        "ref": "github.com/TIBCOSoftware/flogo-contrib/action/flow",
                        "data": {
                            "flowURI": "res://flow:cloud_gw"
                        }
                    },
                    "settings": {
                        "method": "POST",
                        "path": "/lights/status"
                    }
                }
            ]
        }
    ],
    "resources": [
        {
            "id": "flow:alexa_gw_gpio_led",
            "data": {
                "name": "Alexa-GW=GPIOLed",
                "metadata": {
                    "output": [
                        {
                            "name": "code",
                            "type": "integer"
                        },
                        {
                            "name": "message",
                            "type": "string"
                        }
                    ]
                },
                "tasks": [
                    {
                        "id": "log_1",
                        "name": "Received",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "Received request from Alexa",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            }
                        }
                    },
                    {
                        "id": "gpio_1",
                        "name": "SetToOutput",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Direction",
                                "pinNumber": "23",
                                "direction": "Output",
                                "state": "",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "gpio_2",
                        "name": "GetStatus",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Read State",
                                "pinNumber": "23",
                                "direction": "",
                                "state": "",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "log_2",
                        "name": "SetToOnLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            },
                            "mappings": {
                                "input": [
                                    {
                                        "type": "assign",
                                        "value": "$activity[gpio_2].result",
                                        "mapTo": "message"
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "gpio_3",
                        "name": "SetToOn",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": "23",
                                "direction": "",
                                "state": "High",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_5",
                        "name": "Return on",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {
                                "mappings": [
                                    {
                                        "mapTo": "message",
                                        "type": "literal",
                                        "value": "Update light to high successfully"
                                    },
                                    {
                                        "mapTo": "code",
                                        "type": "literal",
                                        "value": 200
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "log_3",
                        "name": "SetToOffLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            },
                            "mappings": {
                                "input": [
                                    {
                                        "type": "assign",
                                        "value": "$activity[gpio_2].result",
                                        "mapTo": "message"
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "gpio_4",
                        "name": "SetToOff",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": "23",
                                "direction": "",
                                "state": "Low",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_6",
                        "name": "Return off",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {
                                "mappings": [
                                    {
                                        "mapTo": "message",
                                        "type": "literal",
                                        "value": "Update light to low successfully"
                                    },
                                    {
                                        "mapTo": "code",
                                        "type": "literal",
                                        "value": 200
                                    }
                                ]
                            }
                        }
                    }
                ],
                "links": [
                    {
                        "from": "log_1",
                        "to": "gpio_1"
                    },
                    {
                        "from": "gpio_1",
                        "to": "gpio_2"
                    },
                    {
                        "from": "gpio_2",
                        "to": "log_2",
                        "type": "expression",
                        "value": "$activity[gpio_2].result==0"
                    },
                    {
                        "from": "log_2",
                        "to": "gpio_3"
                    },
                    {
                        "from": "gpio_3",
                        "to": "actreturn_5"
                    },
                    {
                        "from": "gpio_2",
                        "to": "log_3",
                        "type": "expression",
                        "value": "$activity[gpio_2].result==1"
                    },
                    {
                        "from": "log_3",
                        "to": "gpio_4"
                    },
                    {
                        "from": "gpio_4",
                        "to": "actreturn_6"
                    }
                ]
            }
        },
        {
            "id": "flow:cloud_gw",
            "data": {
                "name": "Cloud-GW",
                "metadata": {
                    "output": [
                        {
                            "name": "code",
                            "type": "integer"
                        },
                        {
                            "name": "message",
                            "type": "string"
                        }
                    ]
                },
                "tasks": [
                    {
                        "id": "log_2",
                        "name": "Log Message",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "Received request.",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            }
                        }
                    },
                    {
                        "id": "gpio_3",
                        "name": "SetToOutput",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Direction",
                                "pinNumber": "23",
                                "direction": "Output",
                                "state": null,
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "gpio_4",
                        "name": "GetStatus",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Read State",
                                "pinNumber": "23",
                                "direction": "",
                                "state": "",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "log_5",
                        "name": "SetToOnLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "",
                                "flowInfo": "false",
                                "addToFlow": "false"
                            },
                            "mappings": {
                                "input": [
                                    {
                                        "type": "assign",
                                        "value": "$activity[gpio_4].result",
                                        "mapTo": "message"
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "gpio_7",
                        "name": "SetToOn",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": "23",
                                "direction": null,
                                "state": "High",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_9",
                        "name": "Return On",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {
                                "mappings": [
                                    {
                                        "mapTo": "code",
                                        "type": "literal",
                                        "value": 200
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "log_6",
                        "name": "SetToOffLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "",
                                "flowInfo": "false",
                                "addToFlow": "false"
                            },
                            "mappings": {
                                "input": [
                                    {
                                        "type": "assign",
                                        "value": "$activity[gpio_4].result",
                                        "mapTo": "message"
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "id": "gpio_8",
                        "name": "SetToOff",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": "23",
                                "direction": null,
                                "state": "Low",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_10",
                        "name": "Return Off",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {
                                "mappings": [
                                    {
                                        "mapTo": "code",
                                        "type": "literal",
                                        "value": 200
                                    }
                                ]
                            }
                        }
                    }
                ],
                "links": [
                    {
                        "from": "log_2",
                        "to": "gpio_3"
                    },
                    {
                        "from": "gpio_3",
                        "to": "gpio_4"
                    },
                    {
                        "from": "gpio_4",
                        "to": "log_5",
                        "type": "expression",
                        "value": "$activity[gpio_4].result==0"
                    },
                    {
                        "from": "log_5",
                        "to": "gpio_7"
                    },
                    {
                        "from": "gpio_7",
                        "to": "actreturn_9"
                    },
                    {
                        "from": "gpio_4",
                        "to": "log_6",
                        "type": "expression",
                        "value": "$activity[gpio_4].result==1"
                    },
                    {
                        "from": "log_6",
                        "to": "gpio_8"
                    },
                    {
                        "from": "gpio_8",
                        "to": "actreturn_10"
                    }
                ]
            }
        }
    ]
}