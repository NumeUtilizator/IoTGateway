{
    "name": "FlogoGW",
    "type": "flogo:app",
    "version": "0.0.1",
    "appModel": "1.0.0",
    "description": "IoT gateway for Raspberry pi",
    "triggers": [
        {
            "id": "receive_mqtt_from_local_broker",
            "ref": "github.com/TIBCOSoftware/flogo-contrib/trigger/mqtt",
            "name": "Receive MQTT from local Broker",
            "description": "Simple MQTT Trigger",
            "settings": {
                "broker": "tcp://127.0.0.1:1883",
                "id": "FLOGO_MQTT_CLIENT",
                "user": null,
                "password": "",
                "store": ":memory:",
                "topic": "vfdemo/Alexa",
                "qos": 0,
                "cleansess": false
            },
            "handlers": [
                {
                    "action": {
                        "ref": "github.com/TIBCOSoftware/flogo-contrib/action/flow",
                        "data": {
                            "flowURI": "res://flow:device_to_gw"
                        }
                    },
                    "settings": {
                        "topic": "vfdemo/Alexa"
                    }
                }
            ]
        }
    ],
    "resources": [
        {
            "id": "flow:device_to_gw",
            "data": {
                "name": "Device to GW",
                "tasks": [
                    {
                        "id": "log_2",
                        "name": "Log MQTT",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "Message arrived",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            }
                        }
                    },
                    {
                        "id": "gpio_3",
                        "name": "Set Direction GPIO",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Direction",
                                "pinNumber": "23",
                                "direction": "Output",
                                "state": "",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "gpio_4",
                        "name": "Read State GPIO&#160;",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Read State",
                                "pinNumber": "23",
                                "direction": null,
                                "state": null,
                                "Pull": null
                            }
                        }
                    },
                    {
                        "id": "log_5",
                        "name": "SetToOnLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "Turning on the led",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            }
                        }
                    },
                    {
                        "id": "gpio_7",
                        "name": "SetToOn GPIO",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": "23",
                                "direction": "",
                                "state": "High",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_10",
                        "name": "Return",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {}
                        }
                    },
                    {
                        "id": "log_6",
                        "name": "SetToOffLog",
                        "description": "Simple Log Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                            "input": {
                                "message": "Turning off the led",
                                "flowInfo": "true",
                                "addToFlow": "true"
                            }
                        }
                    },
                    {
                        "id": "gpio_8",
                        "name": "Control GPIO",
                        "description": "Control raspberry gpio",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/gpio",
                            "input": {
                                "method": "Set State",
                                "pinNumber": 0,
                                "direction": "",
                                "state": "Low",
                                "Pull": ""
                            }
                        }
                    },
                    {
                        "id": "actreturn_11",
                        "name": "Return (2)",
                        "description": "Simple Return Activity",
                        "activity": {
                            "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/actreturn",
                            "input": {}
                        }
                    }
                ],
                "links": [
                    {
                        "from": "log_2",
                        "to": "gpio_3"
                    },
                    {
                        "from": "gpio_3",
                        "to": "gpio_4"
                    },
                    {
                        "from": "gpio_4",
                        "to": "log_5",
                        "type": "expression",
                        "value": "$activity[gpio_4].result==0"
                    },
                    {
                        "from": "log_5",
                        "to": "gpio_7"
                    },
                    {
                        "from": "gpio_7",
                        "to": "actreturn_10"
                    },
                    {
                        "from": "gpio_4",
                        "to": "log_6",
                        "type": "expression",
                        "value": "$activity[gpio_4].result==1"
                    },
                    {
                        "from": "log_6",
                        "to": "gpio_8"
                    },
                    {
                        "from": "gpio_8",
                        "to": "actreturn_11"
                    }
                ],
                "errorHandler": {
                    "tasks": [
                        {
                            "id": "log_9",
                            "name": "Log Message",
                            "description": "Simple Log Activity",
                            "activity": {
                                "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log",
                                "input": {
                                    "message": "error",
                                    "flowInfo": "true",
                                    "addToFlow": "true"
                                }
                            }
                        }
                    ]
                }
            }
        }
    ]
}